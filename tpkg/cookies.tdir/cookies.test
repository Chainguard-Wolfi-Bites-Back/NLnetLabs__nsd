# #-- svcb.test --#
# source the master var file when it's there
[ -f ../.tpkg.var.master ] && source ../.tpkg.var.master
# use .tpkg.var.test for in test variable passing
[ -f .tpkg.var.test ] && source .tpkg.var.test


unshare -rUn
ip address add 198.51.100.100 dev lo
ip link set dev lo up

TZ=UTC faketime -f '2019-06-05 10:53:05' $TPKG_NSD -c cookies.test.conf -p $TPKG_PRI_PORT -P $TPKG_NSD_PRI_PID &

dig -b 198.51.100.100 @198.51.100.100 +cookie=2464c4abcf10c957 > dig.output.a1

if grep -q "2464c4abcf10c957010000005cf79f111f8130c3eee29480" dig.output.a1
then
	echo "A.1. Learning a New Server Cookie: Cookie matches"
else
	echo "A.1. Learning a New Server Cookie: Cookie does not match"
	exit 1
fi
